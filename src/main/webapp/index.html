<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>日志中心</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="layui/css/layui.css">
    <script src="js/jquery-1.7.2.js"></script>
    <script src="layui/layui.js" type="text/javascript"></script>
    <link rel="stylesheet" href="css/zTreeStyle/zTreeStyle.css" type="text/css">
    <script type="text/javascript" src="js/jquery.ztree.core.js"></script>


    <style>
        .left{
            float:left;
            width: 30%;
        }
        #left_top{
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #seachFilePath, #seachFilePathDetail{
            margin-left:30%;
        }
        .right{
            float:right;
            width: 70%;
        }
        #cntent{
            display: flex;
            justify-content: center;
        }
        #input_box{
            display: flex;
        }
        .layui-input-block{
            margin-left: 200px;
        }
    </style>
</head>
<body>
<div class="right" style="position: relative;">
    <div class="layui-input-block" id="keyWord" style="margin-top:5px;">
        <label class="layui-form-label">关键字</label>
        <div id="input_box" class="layui-input-inline">
            <input type="text" id="searchByTime" lay-verify="required" style="width:200px;"
                   placeholder="请输入日志时间" data-provide="typeahead" class="layui-input" autocomplete="off">
            <select id="searchByLevel" name="city" lay-verify="" list="levelList" lay-verify="required" style="width:200px;"
                    placeholder="请输入日志等级" data-provide="typeahead" class="layui-input" autocomplete="off">
                <option value="">选择级别</option>
                <option value="INFO">INFO</option>
                <option value="FATAL">FATAL</option>
                <option value="WARN">WARN</option>
                <option value="ERROR">ERROR</option>
                <option value="DEBUG">DEBUG</option>
            </select>
            <!--<input type="hide" name="RegisterCompanyId" id="hiddenRegisterCompanyId_searchForm" />-->
        </div>
        <button type="text" id="foundPath" style="position: absolute;left: 700px;top: 0px;" class="layui-btn layui-btn-normal">查找</button>
    </div>

    <ul id="biuuu_city_list"></ul>
    <br />
    <br />
    <div id="content" class="xxx" style="margin-left: 0px">无</div>
    <script>
        layui.use(['laypage', 'layer'], function () {
            var laypage = layui.laypage
                , layer = layui.layer;
            $('#foundPath').on('click',function(){
                var seachFilePath =$('#seachFilePath').val();
                var searchByTime = $('#searchByTime').val();
                var searchByLevel = $('#searchByLevel').val();
                console.log("111",seachFilePath);
                console.log(searchByTime);
                console.log(searchByLevel);
                $.ajax({
                    url: 'logController/getKey',
                    type: 'post',
                    data: {
                        searchByTime: searchByTime,
                        searchByLevel: searchByLevel,
                        seachFilePath:seachFilePath,
                    },
                    dataType:'json',
                    success:function(data){
                        console.log(data)
                        //调用分页
                        laypage.render({
                            elem: 'content'
                            , count: data.length
                            , limit:1000
                                ,jump: function (obj) {
                                //模拟渲染
                                    document.getElementById('biuuu_city_list').innerHTML = function () {
                                    var arr = []
                                        , thisData = data.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
                                    layui.each(thisData, function(i,v){
                                        $('#content').append((i+1)+". "+v.path+" "+v.level+" "+v.date+" "+v.detail+"<br>");
                                    });
                                    return arr.join('');
                                }();
                            }
                        });
                    }
                });
            })

            // //调用分页
            // laypage.render({
            //     elem: 'content'
            //     , count: data.length
            //     , limit:20
            //     ,jump: function (obj) {
            //         //模拟渲染
            //         document.getElementById('biuuu_city_list').innerHTML = function () {
            //             var arr = []
            //                 , thisData = data.concat().splice(obj.curr * obj.limit - obj.limit, obj.limit);
            //             layui.each(thisData, function (index, item) {
            //                 arr.push('<li>' + item + '</li>');
            //             });
            //             return arr.join('');
            //         }();
            //     }
            // });

        });
    </script>


</div>




<div id="left_top">
    <input type="text" id="seachFilePath" lay-verify="required" style="width:200px;"
           placeholder="请输入目录地址" data-provide="typeahead" class="layui-input" autocomplete="off">
    <input type="text" id="seachFilePathDetail" lay-verify="required" style="width:200px;"
           placeholder="精确地址" data-provide="typeahead" class="layui-input" autocomplete="off">
    <button type="text" style="margin-left: 30%; width: 100px;text-align: center;" id="findFilepPath" class="layui-btn layui-btn-normal">查找</button>
    <div class="left">
        <div>
            <ul id="treeDemo" class="ztree"></ul>
        </div>

    </div>
    <script>
        var zTreeObj;
        // var setting = {
        //     callback:zTreeOnClick,
        // };
        // 单击事件


        // var setting = {
        //     callback:zTreeOnClick,
        //     view:{
        //         showLine:false //使显示的节点与节点间没有虚线
        //     },
        //     data: {
        //         simpleData: {//规定显示的数据格式
        //             idKey:"id",
        //             pIdKey:"pId",
        //             enable: true,
        //             rootPId:0
        //         }
        //     }
        // };
        function zTreeOnClick(event, treeId, treeNode) {
            var treeNodeName = treeNode.name

            alert(treeNode.tId + ", " + treeNode.name);
        };
        var setting = {
            callback: {
                onClick: zTreeOnClick
            }
        };

        $('#findFilepPath').on('click',function(){
            var seachFilePath =$('#seachFilePath').val();
            var seachFilePathDetail =$('#seachFilePathDetail').val();
            $.ajax({
                url: 'logController/creatTree',
                data:{
                    seachFilePath:seachFilePath,
                    seachFilePathDetail:seachFilePathDetail
                },
                dataType:'json',
                type:'POST',

                success:function(result){
                    var zNodes=eval('('+result+')');
                    console.log(zNodes);
                    $.fn.zTree.init($("#treeDemo"), setting, zNodes);//使tree在id=“treeDemo”的容器中显示


                },
                error:function(){
                }

            });
        });




        // $('#findFilepPath').on('click',function(){
        //     var seachFilePath = $('#seachFilePath').val();
        //     var seachFilePathDetail = $('#seachFilePathDetail').val();
        //     console.log(seachFilePath);
        //     console.log(seachFilePathDetail);
        //     $.ajax({
        //         url: 'logController/creatTree',
        //         type: 'get',
        //         data: {
        //             seachFilePath: seachFilePath,
        //             seachFilePathDetail: seachFilePathDetail
        //         },
        //         dataType:'json',
        //         success:function(data){
        //             console.log("data+++++++++++hhhhh",data)
        //
        //         }
        //     });
        // })

    </script>
</div>






</body>